---
title: "Eda"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, message=FALSE} 

library(plyr)
library(dbplyr)
library(tidyverse)
library(tibble)
library(corrplot)
library(car) 

#faire un code qui ouvre tous les packages dans un autre file (--> setup.R)

```

## Covid

For our first analysis related to the impact of Covid, R2.1, we quickly realized that the data available for antidepressant consumption in 2020 was very limited. We had to make a second selection of countries for this regression in order to observe only the countries with data in 2020, during the covid year. 

```{r}
List.of.Countries2 = c('GRC', 'HUN', 'ISL', 'ITA', 'NOR','PRT', 'SWE', 'ESP')
```
We then create a new modified database for the consumption of antidepressants.
```{r}
Antidepressant_consumption1 <- Antidepressant_consumption %>% filter(LOCATION %in% List.of.Countries2)
```
It is therefore necessary to select the same countries for the covid cases and deaths data.
```{r}
Number_Covid19_cases_deaths1 <-  Number_Covid19_cases_deaths %>% filter(LOCATION %in% List.of.Countries2)
```
We can now reform our table. 
```{r}
tab_R2.1 <- full_join(Number_Covid19_cases_deaths1, Antidepressant_consumption1, by= c("LOCATION","TIME"))
```
We noticed that NAs were present in the table and only for cases and deaths of covid before 2020. We assumed that its values were equal to 0. Also, the "cases" variable was output in character, we converted it to numeric.
```{r}
tab_R2.1[is.na(tab_R2.1)] <- 0 
tab_R2.1$Cases...cumulative.total <- as.numeric(tab_R2.1$Cases...cumulative.total)
View(tab_R2.1)
```
Our table on the use of antidepressants and the number of cases and deaths of covid is now ready to be used. 

We also noticed a problem on our third table, R2.2. Indeed, a large number of NAs were present in the table, which later would not allow us to do analyses. We have removed them and also convert the variable "teleworking" in numerical (which was in character). 

```{r}
tab_R2.2 <- na.omit(tab_R2.2)
tab_R2.2$Teleworking <- as.numeric(tab_R2.2$Teleworking)
View(tab_R2.2)
```

Now all our databases are clean and ready to be used. 

###Analysis 

Firstly, we would like to know if there is a correlation between Cases of Covid and the Value of Antidepressant Consumption through the years. We want to observe whether there is a peak in the consumption of these medications because of the covid crisis. Indeed, we make the hypothesis that due to this crisis, the proportion of people suffering from depression has increased, which would have had a significant impact on this consumption in 2020. 

```{r}
Reg2 <- lm(tab_R2.1$Value~tab_R2.1$Cases...cumulative.total)
summary(Reg2)

cor(tab_R2.1$Value, tab_R2.1$Deaths...cumulative.total)
cor(tab_R2.1$Value, tab_R2.1$Cases...cumulative.total)
```

Unfortunately, we can see that there is no correlation between these variables, either with the number of cases or the number of deaths. 
We can give several explanations to this surprising observation.
The first one is the lack of data. Indeed, we were able to study the evolution of antidepressant consumption in only 8 countries. Perhaps with more countries, we would have seen a more significant difference. 

The second and the most likely, is that we can see that the number of cases (and deaths) related to covid are huge numbers, going from 0 to several millions (to thousands). However, compared to these numbers, the value of antidepressants consumption is increasing well as we can see in the graph below but not as much as the number of cases. The ratio is not the same. It would be interesting, later on, to calculate the value of the increase in consumption, by years and see if we can observe a difference between years or not. 

```{r}
ggplot(data = tab_R2.1) +
  geom_point(mapping = aes(x = TIME, y = Value, color = LOCATION))
```

Given the results, we thought it would be more interesting to observe the rate of depression by country between 2000 and 2021. Here is the table of depression rate by selected countries in 2017 and 2021. This table was made because we could not find the data for the years 2018,2019 and 2020. So we wanted to compare these two dates to see if there was a significant difference. 
```{r}
View(tab_R2.1.1)

ggplot(data = tab_R2.1.1) +
  geom_point(mapping = aes(x = TIME , y = VALUE, color = LOCATION)) +
  geom_smooth(se = FALSE)
```


Now that we see the increase, we will calculate the growth rate per year (from 2000 to 2017) and then make a projection, a hypothesis, for the following years including 2021, based on the values obtained. 
A new table must be created with values from 2000 to 2017 and 2021.  



We will now focus on our second study, which is the evolution of antidepressant consumption as a function of teleworking and unemployment rate. 

The following graph shows the evolution of antidepressant consumption, which is increasing. 
```{r}
ggplot(data = tab_R2.2) +
  geom_point(mapping = aes(x = TIME, y = Value, color = LOCATION))
```

```{r}
Reg2.2 <- lm(tab_R2.2$Value~tab_R2.2$Teleworking+tab_R2.2$Unemployment)
summary(Reg2.2)
```

With the *summary* function we can see a significant increase for one unit of  1.70310 * ValueAntidepressantConsumption for "Teleworking". This variable is significant with 2 stars wich is satisfying. However, the "Unemployment" is not significant as it represents an increase for one unit of 0.04958 * ValueAntidepressantConsumption. 

We can do a forward selection: 
```{r}
mod0 <- lm(tab_R2.2$Value~1)
summary(mod0)
mod1 <- lm(tab_R2.2$Value~tab_R2.2$Teleworking)
summary(mod1)
mod2 <- lm(tab_R2.2$Value~tab_R2.2$Teleworking+tab_R2.2$Unemployment)
summary(mod2)
```
Given the results, this confirms that unemployment is not significant and that this variable could be removed. 






