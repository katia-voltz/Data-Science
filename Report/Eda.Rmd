---
title: "Eda"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, message=FALSE} 

library(plyr)
library(dbplyr)
library(tidyverse)
library(tibble)
library(corrplot)
library(car) 

#faire un code qui ouvre tous les packages dans un autre file (--> setup.R)

```

Now all our databases are clean and ready to be used. 

## Covid

The final table and its plot that we obtain in Data.Rmd allow us to do correlation tests and to have visual representations of all these movements.

1. Income Inequality Analysis 

````{r}
reg0 <- lm(tab_Tot$Mental_Health~tab_Tot$Income_Inequality)
summary(reg0)
plot(tab_Tot$Income_Inequality, tab_Tot$Mental_Health)
ggplot(data = tab_Tot) + geom_point(mapping = aes(x = Income_Inequality, y = Mental_Health, color = LOCATION))
```

We have *  and we can see that the higher the income inequality, the higher the share of the population with mental health disorders is.

2. Wages Analysis

````{r}
reg1 <- lm(tab_Tot$Mental_Health~tab_Tot$wages)
summary(reg1)
plot(tab_Tot$wages, tab_Tot$Mental_Health)
ggplot(data = tab_Tot) + geom_point(mapping = aes(x = wages, y = Mental_Health , color = LOCATION))
```

We have **  and we can see that the higher the wages, the higher the share of the share of the population with mental health disorders is.

3. Unemployment Analysis

````{r}
reg2 <- lm(tab_Tot$Mental_Health~tab_Tot$Unemployment)
summary(reg2)
plot(tab_Tot$Unemployment, tab_Tot$Mental_Health)
ggplot(data = tab_Tot) + geom_point(mapping = aes(x = Unemployment, y = Mental_Health , color = LOCATION))
```

We have 0 and it doesn't seem to have any distinct correlation between this two variables.

4. Working Age Analysis

````{r}
reg3 <- lm(tab_Tot$Mental_Health~tab_Tot$Working_Age)
summary(reg3)
plot(tab_Tot$Working_Age, tab_Tot$Mental_Health)
ggplot(data = tab_Tot) + geom_point(mapping = aes(x = Working_Age, y = Mental_Health , color = LOCATION))
```

We have ** and we can see that the share of the population with mental health disorders is higher when the working age is lower.

5. Work Time Analysis

````{r}
reg4 <- lm(tab_Tot$Mental_Health~tab_Tot$Work_Time)
summary(reg4)
plot(tab_Tot$Work_Time, tab_Tot$Mental_Health)
ggplot(data = tab_Tot) + geom_point(mapping = aes(x = Work_Time, y = Mental_Health, color = LOCATION)) ```

We have 0 and it doesn't seem to have any distinct correlation between this two variables 

6. GDP Analysis

````{r}
reg5 <- lm(tab_Tot$Mental_Health~tab_Tot$GDP)
summary(reg5)
plot(tab_Tot$GDP, tab_Tot$Mental_Health)
ggplot(data = tab_Tot) + geom_point(mapping = aes(x = GDP, y = Mental_Health , color = LOCATION))
```
We have ** and it seems that when the GDP tends to be high, the share of the population with mental health disorders also tends to be high.

We used many variables to test this effect of the work environment on mental health in these countrie. Thus we thought it wise to use a forward induction in order to define which of them are really significant. 

````{r}
mod0 <- lm(tab_Tot$Mental_Health~1)
summary(mod0)
mod1 <- lm(tab_Tot$Mental_Health~tab_Tot$Income_Inequality)
summary(mod1)
mod2 <- lm(tab_Tot$Mental_Health~tab_Tot$Income_Inequality+tab_Tot$wages)
summary(mod2)
mod3 <- lm(tab_Tot$Mental_Health~tab_Tot$Income_Inequality+tab_Tot$wages+tab_Tot$Working_Age)
summary(mod3)
```
The result that we have is *** for Income_Inequality and ** for wages and working_Age.






## Covid


###Analysis 

Firstly, we would like to know if there is a correlation between Cases of Covid and the Value of Antidepressant Consumption through the years. We want to observe whether there is a peak in the consumption of these medications because of the covid crisis. Indeed, we make the hypothesis that due to this crisis, the proportion of people suffering from depression has increased, which would have had a significant impact on this consumption in 2020. 

```{r}
Reg2 <- lm(tab_R2.1$Value~tab_R2.1$Cases...cumulative.total)
summary(Reg2)

cor(tab_R2.1$Value, tab_R2.1$Deaths...cumulative.total)
cor(tab_R2.1$Value, tab_R2.1$Cases...cumulative.total)
```

Unfortunately, we can see that there is no correlation between these variables, either with the number of cases or the number of deaths. 
We can give several explanations to this surprising observation.
The first one is the lack of data. Indeed, we were able to study the evolution of antidepressant consumption in only 8 countries. Perhaps with more countries, we would have seen a more significant difference. 

The second and the most likely, is that we can see that the number of cases (and deaths) related to covid are huge numbers, going from 0 to several millions (to thousands). However, compared to these numbers, the value of antidepressants consumption is increasing well as we can see in the graph below but not as much as the number of cases. The ratio is not the same. It would be interesting, later on, to calculate the value of the increase in consumption, by years and see if we can observe a difference between years or not. 

```{r}
ggplot(data = tab_R2.1) +
  geom_point(mapping = aes(x = TIME, y = Value, color = LOCATION))
```

Given the results, we thought it would be more interesting to observe the rate of depression by country between 2000 and 2021. Here is the table of depression rate by selected countries in 2017 and 2021. This table was made because we could not find the data for the years 2018,2019 and 2020. So we wanted to compare these two dates to see if there was a significant difference. 
```{r}
View(tab_R2.1.1)

ggplot(data = tab_R2.1.1) +
  geom_point(mapping = aes(x = TIME , y = VALUE, color = LOCATION)) +
  geom_smooth(se = FALSE)
```


Now that we see the increase, we will calculate the growth rate per year (from 2000 to 2017) and then make a projection, a hypothesis, for the following years including 2021, based on the values obtained. 
A new table must be created with values from 2000 to 2017 and 2021.  



We will now focus on our second study, which is the evolution of antidepressant consumption as a function of teleworking and unemployment rate. 

The following graph shows the evolution of antidepressant consumption, which is increasing. 
```{r}
ggplot(data = tab_R2.2) +
  geom_point(mapping = aes(x = TIME, y = Value, color = LOCATION))
```

```{r}
Reg2.2 <- lm(tab_R2.2$Value~tab_R2.2$Teleworking+tab_R2.2$Unemployment)
summary(Reg2.2)
```

With the *summary* function we can see a significant increase for one unit of  1.70310 * ValueAntidepressantConsumption for "Teleworking". This variable is significant with 2 stars wich is satisfying. However, the "Unemployment" is not significant as it represents an increase for one unit of 0.04958 * ValueAntidepressantConsumption. 

We can do a forward selection: 
```{r}
mod0 <- lm(tab_R2.2$Value~1)
summary(mod0)
mod1 <- lm(tab_R2.2$Value~tab_R2.2$Teleworking)
summary(mod1)
mod2 <- lm(tab_R2.2$Value~tab_R2.2$Teleworking+tab_R2.2$Unemployment)
summary(mod2)
```
Given the results, this confirms that unemployment is not significant and that this variable could be removed. That's why we will now now focus on teleworking which would have an impact on the consumption of antidepressants. 

Here is a graph that shows the increase in the value of the consumption according to the teleworking. 
```{r}
ggplot(data = tab_R2.2, mapping = aes(x = Value, y = Teleworking)) +
  geom_point(mapping = aes(color = LOCATION)) +
  geom_smooth()
```


