---
title: "Data"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) # supprimer ? a quoi il sert ?
```

First, we need to install different packages. 

```{r, echo=FALSE, message=FALSE}
library(plyr)
library(dbplyr)
library(tidyverse)
library(tibble)
library(corrplot)
library(car)
#faire un code qui ouvre tous les packages dans un autre file (--> setup.R)
```

For our research, we are going to use different datasets for our three main themes. 

## Work Environment

First of all, for the database concerning the environment at work, we have extracted all the data from the sites : <https://www.oecd.org> and <https://ourworldindata.org>. 

Our first resarch question was : Given the structure of the working environment in different countries, can we say that the mental health of the population is influenced by the working conditions and the situation of the country?

To see those effects , we have chosen the information of 7 variables ; 

- the average work-time
- the GPD
- the unemployment rate 
- the working age population
- the salaries
- the income inequalities 

We took the data for each of these variables for a certain sample of countries and then chose to do an individual average over the years from 2000 to 2017.

Regression 1 : MentalHealth = a*IncomeInequality + b*wages + c*Unemployment + d*WorkingAgePopulation + e*WorkTime + f*GPD

In order to have a table with all of our variables .....
we start by sorting our data ....


```{r}


```

````{r}


```

## Covid 

For our second theme around Covid, we wanted to analyze if Covid had an impact on antidepressant consumption and we found data on antidepressant consumption on the 
website : <https://www.oecd.org>, in the Pharmaceutical Market Section. 
Regarding the Covid data, they come from the site : <https://coronavirus.jhu.edu>. 

Regression 2.1 : Antidepressant_consumption = a*Number_Covid-19_Cases + b*Number_Covid-19_Deaths

First of all, we have made a selection of several countries which are the following (To simplify, country codes have been used and not the full names) : Austria, 
Belgium, Croatia, Czechia, Denmark, Finland, France, Germany, Greece, Hungary, Iceland, Ireland, Italy, Romania, Portugal, Poland, Norway, Netherlands, Switzerland, 
Sweden, Spain, Australia, Brazil, Canada, China, Japan, New-Zealand and the USA.  

```{r}
List.of.Countries = c('AUT','BEL','HRV', 'CZE', 'DNK', 'ENG', 'FIN', 'FRA', 'DEU', 'GRC', 'HUN','ISL',
                      'ITA', 'ROU', 'PRT', 'POL', 'NOR', 'NLD', 'CHE', 'SWE', 'ESP', 'AUS', 'BRA',
                      'CAN', 'CHN', 'JPN', 'NZL', 'USA')
```

Another list of countries has been made, to select countries to select the countries where we had data available on antidepressant consumption in 2020, to be able to then observe a change or not due to the Covid. 

```{r}
List.of.Countries2 = c('GRC', 'HUN', 'ISL', 'ITA', 'NOR','PRT', 'SWE', 'ESP')
```

Now we can select and sort the data. 

```{r}
Antidepressant_consumption <- read.csv("Conso Antidepressant.csv") #--> Mettre un code qui sélectionne la donnée depuis le bon emplacement : read.csv(here::here("data/Conso Antidepressant.csv")) ? 
attach(Antidepressant_consumption)
```

For all the variables we only kept the columns on the country, the date and the value of the variable, because they were the only ones that interested us. All the others have therefore been deleted.
It was also often necessary to rename the columns so that they all follow the scheme: LOCATION, TIME and VALUE. 

```{r}
Antidepressant_consumption <- Antidepressant_consumption[,-c(1:4,6:7,10:11)]
Antidepressant_consumption <- rename(Antidepressant_consumption,c("LOCATION"="COU","TIME"="Year"))
Antidepressant_consumption1 <- Antidepressant_consumption %>% filter(LOCATION %in% List.of.Countries2)
View(Antidepressant_consumption1)
````

```{r}
Number_Covid19_cases_deaths <- read.csv2("Cases + Deaths Covid.csv")
attach(Number_Covid19_cases_deaths)
Number_Covid19_cases_deaths <- Number_Covid19_cases_deaths[,-c(1,2,4:7,9:12)]
Number_Covid19_cases_deaths <- Number_Covid19_cases_deaths[-1,] 
Number_Covid19_cases_deaths <- rename(Number_Covid19_cases_deaths, "LOCATION"="Code")
Number_Covid19_cases_deaths <- Number_Covid19_cases_deaths %>% add_column(TIME = 2020, .after = "LOCATION") 
Number_Covid19_cases_deaths <-  Number_Covid19_cases_deaths %>% filter(LOCATION %in% List.of.Countries2)
View(Number_Covid19_cases_deaths)
````

We can now form a table with all the data together, using the "full_join" function. 

```{r}
tab_R2.1 <- full_join(Number_Covid19_cases_deaths, Antidepressant_consumption, by= c("LOCATION","TIME"))
```

As the data of cases and death of the covid for the years before 2020 were displayed in NA, they had to be equalized to 0. Also, the "cases" variable was output in character, we converted it to numeric.

```{r}
tab_R2.1[is.na(tab_R2.1)] <- 0 
tab_R2.1$Cases...cumulative.total <- as.numeric(tab_R2.1$Cases...cumulative.total)
View(tab_R2.1)
```

We also wanted to analyze the evolution of the depression rate between 2010 and 2017, and if the covid had an impact on it in 2021. Our data comes frome the sites : <https://ourworldindata.org/mental-health#depression> and <https://worldpopulationreview.com/>. 

```{r}
Depression_Rate2017 <- read.csv("Depression Rate 2000:2017.csv")
attach(Depression_Rate2017)
Depression_Rate2017 <- Depression_Rate2017[-1]
Depression_Rate2017 <- rename(Depression_Rate2017,c("LOCATION"="Code","TIME"="Year"))
Depression_Rate2017 <- rename(Depression_Rate2017, "2017"="Prevalence...Depressive.disorders...Sex..Both...Age..Age.standardized..Percent.")
Depression_Rate2017 <- Depression_Rate2017 %>%
  filter(TIME>2016)
Depression_Rate2017 <- Depression_Rate2017 %>% filter(LOCATION %in% List.of.Countries)
Depression_Rate2017 <- Depression_Rate2017[-2]
View(Depression_Rate2017)
```
```{r}
Depression_Rate2021 <- read.csv2("Depression Rate 2021.csv")
attach(Depression_Rate2021)
Depression_Rate2021 <- Depression_Rate2021[,-c(1,3:4)]
Depression_Rate2021 <- rename(Depression_Rate2021,c("2021"="prevalence"))
Depression_Rate2021 <- Depression_Rate2021 %>% filter(LOCATION %in% List.of.Countries)
Depression_Rate2021 <- Depression_Rate2021 %>% add_column(TIME = 2021, .after = "LOCATION") 
Depression_Rate2021 <- Depression_Rate2021[-3]
View(Depression_Rate2021)
```

```{r}
tab_test <- Depression_Rate2017 %>%
  inner_join(Depression_Rate2021, by = "LOCATION")
tab_test$"2021" <- as.numeric(tab_test$"2021")
tab_test <- tab_test %>%
  pivot_longer(c(`2017`, `2021`),
               names_to = "TIME",
               values_to = "VALUE")
View(tab_test)
```

For the second study of this theme, information on Teleworking and Unemployment were extracted respectively from the sites : <https://ec.europa.eu/eurostat> and <https://data.oecd.org>. 

```{r}
Antidepressant_consumption2 <- Antidepressant_consumption %>% filter(LOCATION %in% List.of.Countries)
View(Antidepressant_consumption2)
```

```{r}
Teleworking <- read.csv2("Teleworking.csv")
attach(Teleworking)
Teleworking <- Teleworking[,-c(1:8,12)]
Teleworking <- rename(Teleworking,c("LOCATION"="geo","TIME"="TIME_PERIOD","Teleworking"="OBS_VALUE"))
Teleworking <-  Teleworking %>% filter(LOCATION %in% List.of.Countries)
View(Teleworking)
```

```{r}
UnemploymentCovid <- read.csv("Unemployement Rate.csv")
attach(UnemploymentCovid)
UnemploymentCovid <- UnemploymentCovid[,-c(2:5,8)]
UnemploymentCovid <- rename(UnemploymentCovid, c("Unemployment"="Value"))
UnemploymentCovid <-  UnemploymentCovid %>% filter(LOCATION %in% List.of.Countries)
View(UnemploymentCovid)
```

```{r}
tab <- full_join(Antidepressant_consumption2, Teleworking, by=c("LOCATION", "TIME"))
tab_R2.2 <- full_join(tab, UnemploymentCovid, by = c("LOCATION", "TIME"))
tab_R2.2 <- na.omit(tab_R2.2)
tab_R2.2$Teleworking <- as.numeric(tab_R2.2$Teleworking)
View(tab_R2.2)
```



