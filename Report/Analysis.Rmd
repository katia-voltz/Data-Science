---
title: "Analysis"
output: html_document
---


```{r, echo = FALSE, message = FALSE}
source(here::here("scripts/Setup.R"))
```


### Work environment 


We decide to do a cluster analysis to see if there is some prevalence of certain region compared to others, and also wanted to study our problem through another perspective, that of the countries. Indeed, we could notice on the first plots, some countries adopt more extreme behaviors (position separated from the others) and it is often the same across the different variables.  A good way to analyze this is to group our countries using clusters. The goal is to see if the work environment has more impact in some countries
than in others on the mental health of its population. This is also where we will use our table of averages that we made for each of the variables.


# ATTENTION MARCHE PAS SI NA DONC JE LES ENLEVE POUR L'INSTANT
```{r}
tab_mean_na <- na.omit(tab_mean)
```
# Table ? : Cluster analysis for each of our explanatory variables
```{r}
# Income Inequality
data_t0 <- tab_mean_na[-1]
data_t0 <- data_t0[,c(2,1)]
mean_data <- apply(data_t0, 2, mean)
std <- apply(data_t0,2,sd)
data_t0_std <- scale(data_t0, mean_data, std)
row.names(data_t0_std) <- tab_mean_na[,1]
distance <- dist(data_t0_std)
hc <- hclust(distance)
avclust <- hclust(distance, method = "average")
km.res <- kmeans(data_t0_std, 5)
C0 <- fviz_cluster(km.res, data=data_t0_std, repel = TRUE) 

# Wages
data_t1 <- tab_mean_na[-1]
data_t1 <- data_t1[,c(3,1)]
mean_data <- apply(data_t1, 2, mean)
std <- apply(data_t1,2,sd)
data_t1_std <- scale(data_t1, mean_data, std)
row.names(data_t1_std) <- tab_mean_na[,1]
distance <- dist(data_t1_std)
hc <- hclust(distance)
avclust <- hclust(distance, method = "average")
km.res <- kmeans(data_t1_std, 5)
C1 <- fviz_cluster(km.res, data=data_t1_std, repel = TRUE)

# Unemployment
data_t2 <- tab_mean_na[-1]
data_t2 <- data_t2[,c(4,1)]
mean_data <- apply(data_t2, 2, mean)
std <- apply(data_t2,2,sd)
data_t2_std <- scale(data_t2, mean_data, std)
row.names(data_t2_std) <- tab_mean_na[,1]
distance <- dist(data_t2_std)
hc <- hclust(distance)
avclust <- hclust(distance, method = "average")
km.res <- kmeans(data_t2_std, 5)
C2 <- fviz_cluster(km.res, data=data_t2_std, repel = TRUE)

# Working Age
data_t3 <- tab_mean_na[-1]
data_t3 <- data_t3[,c(5,1)]
mean_data <- apply(data_t3, 2, mean)
std <- apply(data_t3,2,sd)
data_t3_std <- scale(data_t3, mean_data, std)
row.names(data_t3_std) <- tab_mean_na[,1]
distance <- dist(data_t3_std)
hc <- hclust(distance)
avclust <- hclust(distance, method = "average")
km.res <- kmeans(data_t3_std, 5)
C3 <- fviz_cluster(km.res, data=data_t3_std, repel = TRUE)

# GDP
data_t5 <- tab_mean_na[-1]
data_t5 <- data_t5[,c(7,1)]
mean_data <- apply(data_t5, 2, mean)
std <- apply(data_t5,2,sd)
data_t5_std <- scale(data_t5, mean_data, std)
row.names(data_t5_std) <- tab_mean_na[,1]
distance <- dist(data_t5_std)
hc <- hclust(distance)
avclust <- hclust(distance, method = "average")
km.res <- kmeans(data_t5_std, 5)
C4 <- fviz_cluster(km.res, data=data_t5_std, repel = TRUE)

# Put all the graphs together
plot_grid(C0, C1, C2, C3, C4, labels=c("A","B","C","D","E","F"), ncol=2, nrow=3)
```

This table ? shows us that, regardless of the work environment variable, we always have a clear demarcation. Indeed, it is always the same countries in the same places. We can therefore conclude that each region has its own specificities related to the work environment that impact the rate of mental health disorders. 

It would therefore be interesting to see how these behave according to the regions. 

# Table ?? : Impact of work environment's variables on mental health disorders by region 
```{r}
GG00 <- tab %>% ggplot(aes(
  x = Income_Inequality,
  y = Mental_Health,
  group = Entity,
  color = Region
)) +
  geom_path() +
  theme(axis.text.x = element_text(
    angle = 360,
    hjust = 1,
    vjust = 0.5
  )) +
  ggtitle("Pas encore de titre") +
  xlab("Income inequality") + ylab("Prevalence of mental health value in %") 
ggplotly(GG00)

GG11 <- tab %>% ggplot(aes(
  x = Wages,
  y = Mental_Health,
  group = Entity,
  color = Region
)) +
  geom_path() +
  theme(axis.text.x = element_text(
    angle = 360,
    hjust = 1,
    vjust = 0.5
  )) +
  ggtitle("Pas encore de titre") +
  xlab("wage") + ylab("Prevalence of mental health value in %") 
ggplotly(GG11)

GG22 <- tab %>% ggplot(aes(
  x = Unemployment,
  y = Mental_Health,
  group = Entity,
  color = Region
)) +
  geom_path() +
  theme(axis.text.x = element_text(
    angle = 360,
    hjust = 1,
    vjust = 0.5
  )) +
  ggtitle("Pas encore de titre") +
  xlab("Unemployment") + ylab("Prevalence of mental health value in %") 
ggplotly(GG22)

GG33 <- tab %>% ggplot(aes(
  x = Working_Age,
  y = Mental_Health,
  group = Entity,
  color = Region
)) +
  geom_path() +
  theme(axis.text.x = element_text(
    angle = 360,
    hjust = 1,
    vjust = 0.5
  )) +
  ggtitle("Pas encore de titre") +
  xlab("Working age") + ylab("Prevalence of mental health value in %") 
ggplotly(GG33)

GG44 <- tab %>% ggplot(aes(
  x = GDP,
  y = Mental_Health,
  group = Entity,
  color = Region
)) +
  geom_path() +
  theme(axis.text.x = element_text(
    angle = 360,
    hjust = 1,
    vjust = 0.5
  )) +
  ggtitle("Pas encore de titre") +
  xlab("GDP") + ylab("Prevalence of mental health value in %") 
ggplotly(GG44)
````





